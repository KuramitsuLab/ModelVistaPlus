# 要件定義書：ベンチマーク問題レビューツール

## 1. システム概要

本ツールは、UMLモデル図などを参照する4選択問題（ベンチマーク問題）の品質レビューを効率化するためのブラウザベースのアプリケーションです。レビュワーが画像を見ながら問題の採用・不採用を判定し、結果をJSONファイルとして出力します。

## 2. 機能要求

### 2.1 初期設定機能
- **FR-001**: レビュワー名入力機能
  - レビュワー名を入力し、LocalStorageに保存する
  - 次回起動時に前回の名前を自動読み込み

### 2.2 データ読み込み機能
- **FR-002**: フォルダ選択機能
  - `model/`配下のフォルダ一覧をドロップダウンで表示
  - ドロップダウンで選択可能（例：activity001, class001）
  - サーバーから動的に取得

- **FR-003**: JSONファイル選択機能
  - 選択したフォルダ内の`qa_new_ja.json`および`qa_new_ja2.json`を自動検出
  - 第2のドロップダウンで選択可能
  - 各JSONファイルは独立してレビュー可能
  - レビュー済みの場合は「✅ レビュー済み」と表示

- **FR-004**: 画像表示機能
  - 選択したフォルダ内の`dgpowerpoint_ja-fs8.png`を自動読み込み
  - 画面左側に大きく表示
  - 相対パスで自動取得（`../model/{フォルダ名}/dgpowerpoint_ja-fs8.png`）

### 2.3 問題表示機能
- **FR-005**: 問題文表示
  - 現在の問題番号（第N問）を表示
  - 残り問題数を表示
  - タグ（例：依存関係、機能要求）を表示
  - 問題文を読みやすく表示

- **FR-006**: 選択肢表示
  - 4つの選択肢をラジオボタンで表示
  - **正解（常に1番目）を視覚的に強調表示**（背景色、太字、アイコンなど）

- **FR-007**: メタ情報表示
  - `authored_by`（作成者）を表示
  - `is_translated`（翻訳フラグ）を表示

### 2.4 レビュー機能
- **FR-008**: 採用・不採用判定
  - 「採用」「不採用」ラジオボタンで判定を選択
  - 判定は必須（選択しないと次へ進めない）

- **FR-009**: 備考欄
  - テキストエリアで自由にコメント入力可能
  - 不採用理由や改善提案を記録

- **FR-010**: レビュー状態の保存
  - LocalStorageに現在の進捗を自動保存
  - ブラウザを閉じても再開可能

### 2.5 ナビゲーション機能
- **FR-011**: 前へ/次へボタン
  - 「前へ」ボタンで前の問題に戻る（1問目では無効化）
  - 「次へ」ボタンで次の問題へ進む（最終問題では「完了」表示）
  - キーボードショートカット対応（オプション：←/→キー）

### 2.6 フィルタリング機能
- **FR-012**: レビュー状態フィルタ
  - 「全て」「未レビュー」「レビュー済み」でフィルタリング
  - フィルタ適用時は該当する問題のみ表示

- **FR-013**: タグフィルタ（オプション）
  - 特定のタグ（例：依存関係）のみ表示

### 2.7 出力機能
- **FR-014**: レビュー結果の出力
  - 「エクスポート」ボタンで結果を生成
  - 採用問題：`{ベースファイル名}_approved.json`（例：`qa_new_ja_approved.json`, `qa_new_ja2_approved.json`）
  - 不採用問題：`{ベースファイル名}_rejected.json`（例：`qa_new_ja_rejected.json`, `qa_new_ja2_rejected.json`）
  - 出力ファイルはサーバー経由で`model/{フォルダ名}/`に直接保存
  - ダウンロード不要（自動保存）

- **FR-015**: レビュー状態の出力
  - `review_status.json`を生成（フォルダ全体で1つ）
  - レビュワー名、レビュー日時、進捗状況を記録
  - 複数のJSONファイルのレビュー状態を統合管理
  - 新形式：`{ folderName, reviews: { "qa_new_ja.json": {...}, "qa_new_ja2.json": {...} } }`

### 2.8 データ整合性機能
- **FR-016**: レビュー状態の読み込み
  - 既存の`review_status.json`があれば読み込み
  - 前回のレビュー結果を復元

- **FR-017**: 競合検出（オプション）
  - 複数人が同じ問題をレビューした場合に警告
  - 最終更新日時で判定

## 3. 非機能要求

### 3.1 可用性
- **NFR-001**: ブラウザで動作
  - ブラウザベースのWebアプリケーション
  - **Pythonサーバー（server.py）が必要**：ファイル保存機能のため
  - 対応ブラウザ：Chrome、Firefox、Safari、Edge（最新版）
  - サーバー起動：`python3 server.py` または `./start_server.sh`

### 3.2 パフォーマンス
- **NFR-002**: 高速な問題処理
  - 問題切り替えは0.1秒以内
  - 画像読み込みは1秒以内
  - 100問を扱っても快適に動作

### 3.3 ユーザビリティ
- **NFR-003**: 直感的なUI
  - **1画面で全情報を表示（スクロール不要）**：CSS最適化により実現
  - 明確な視覚フィードバック（採用/不採用の色分け）
  - 正解選択肢の視覚的強調（緑色背景 + ★マーク）
  - レスポンシブデザイン（最小幅1280px推奨）

- **NFR-004**: 操作効率
  - マウス操作のみで完結
  - 問題あたり平均10秒でレビュー可能
  - ドロップダウンでフォルダ・JSON選択（Finder不要）

### 3.4 保守性
- **NFR-005**: コードの可読性
  - 関数は50行以内
  - コメント記載率30%以上
  - 変数名・関数名は日本語可（英語推奨）

### 3.5 データ管理
- **NFR-006**: Gitでのバージョン管理
  - 出力ファイルはGitで管理可能な形式（JSON）
  - 差分が見やすい形式（インデント付きJSON）

- **NFR-007**: 複数人作業対応
  - pull/push運用を想定
  - `review_status.json`で進捗共有
  - 競合時の手動マージ手順を明記（マニュアル）

## 4. 制約事項

### 4.1 データ構造
- **C-001**: JSONファイルは所定のスキーマに従う
  ```json
  {
    "tag": "string",
    "question": "string",
    "choice": ["string", "string", "string", "string"],
    "authored_by": "string",
    "is_translated": boolean
  }
  ```
- **C-002**: 正解は常に`choice[0]`（1番目）
- **C-003**: 画像は`dgpowerpoint_ja-fs8.png`のみ対応（拡張予定）

### 4.2 ファイル操作
- **C-004**: 元のJSONファイルは変更しない（読み取り専用）
- **C-005**: ファイル保存はサーバー経由で実行
  - クライアント側からのPOSTリクエストで`server.py`に送信
  - サーバーが`model/{フォルダ名}/`に直接書き込み

### 4.3 運用
- **C-006**: Git操作は手動（ツールは自動化しない）
- **C-007**: 複数人が同時に同じJSONファイルをレビューすることは想定しない
  - `review_status.json`で調整
  - 各JSONファイル（qa_new_ja.json, qa_new_ja2.json）は独立管理

## 5. ユースケース

### 5.1 基本フロー
1. Pythonサーバーを起動（`python3 server.py` または `./start_server.sh`）
2. ブラウザで`http://localhost:8000/src/index.html`を開く
3. レビュワー名を入力（右上）
4. フォルダをドロップダウンから選択（例：activity001）
5. JSONファイルをドロップダウンから選択（例：qa_new_ja.json または qa_new_ja2.json）
6. 自動的に画像と問題が読み込まれる
7. 画像と問題を確認（正解は緑色で強調表示）
8. 採用/不採用を判定し、必要に応じて備考を入力
9. 「次へ」ボタンで次の問題へ
10. 全問題完了後、「エクスポート」ボタンをクリック
11. ファイルが自動的に`model/{フォルダ名}/`に保存される
12. `git add model/{フォルダ名}/*_approved.json model/{フォルダ名}/*_rejected.json model/{フォルダ名}/review_status.json`
13. `git commit -m "Review: {フォルダ名} by {レビュワー名}"`
14. `git push`

### 5.2 代替フロー
- **5.2.1**: 途中でブラウザを閉じた場合
  - 次回起動時にLocalStorageから進捗を復元

- **5.2.2**: 前の問題に戻りたい場合
  - 「前へ」ボタンで戻り、判定を変更可能

- **5.2.3**: 特定の問題だけレビューしたい場合
  - フィルタ機能を使用（未実装の場合は手動でスキップ）

## 6. 画面レイアウト

```
┌─────────────────────────────────────────────────────────────┐
│ ベンチマーク問題レビューツール              [レビュワー: ___] │
├──────────────────────┬──────────────────────────────────────┤
│                      │  第N問 / 全M問        残り K問       │
│                      ├──────────────────────────────────────┤
│                      │ [タグ: 依存関係]                      │
│                      │                                      │
│   画像表示エリア      │ 【問題】                             │
│   (dgpowerpoint_ja   │ ～～～～～～～～～～～？              │
│    -fs8.png)         │                                      │
│                      │ ┌─────────────────────────────────┐ │
│                      │ │ ○ ★正解: 選択肢1（強調表示）    │ │
│                      │ │ ○ 選択肢2                        │ │
│                      │ │ ○ 選択肢3                        │ │
│                      │ │ ○ 選択肢4                        │ │
│                      │ └─────────────────────────────────┘ │
│                      │                                      │
│                      │ ○ 採用      ○ 不採用                │
│                      │ ┌────────────────────────────────┐  │
│                      │ │ 備考:                           │  │
│                      │ │                                 │  │
│                      │ └────────────────────────────────┘  │
├──────────────────────┴──────────────────────────────────────┤
│ [前へ]                                          [次へ]      │
└─────────────────────────────────────────────────────────────┘
```

## 7. 将来的な拡張

- **EXT-001**: `qa_old_ja.json`への対応
- **EXT-002**: 他の画像タイプへの対応（dghandwritten_ja-fs8.pngなど）
- **EXT-003**: レビュー統計機能（採用率、レビュワー別集計）
- **EXT-004**: より高度な競合解決機能（自動マージ提案）
- **EXT-005**: 複数画像の比較表示
- **EXT-006**: 問題の自動品質チェック（選択肢の長さ、文法チェックなど）

## 8. 受入基準

- 全機能要求（FR-001～FR-017）が実装され、動作すること
- 非機能要求（NFR-001～NFR-007）を満たすこと
- ユーザマニュアルに従って操作できること
- 10問以上のテストデータでレビューが完了すること
- 出力されたJSONファイルが正しいスキーマに従うこと
